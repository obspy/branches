\include{common}
\title{ObsPy's Core Functionality}
\begin{document}

\frame[plain]{\titlepage}

\begin{frame}[plain, fragile]{obspy.core}
This central module is the glue between all other ObsPy modules.

    \begin{itemize}
        \item Unified interface and functionality for handling waveform data in
            form of the \textbf{Stream} and \textbf{Trace} classes.
        \item All absolute time values within ObsPy are consistently handled
            with the \textbf{UTCDateTime} class.
        \item Event data is handled with the \textbf{Event} class. More about
            this later on.
        \item Generally useful utility classes and functions like the
            \textbf{AttribDict} class.
        \item Management via plugin discovery and binding, a global test
            script, \ldots
    \end{itemize}
\end{frame}


\begin{frame}[plain, fragile]{}
    \begin{center}
        \textcolor{lmu@darkgreen}{\LARGE{Goal: Familiarize Yourself With ObsPy's Core Objects and Functions}}
    \end{center}
\end{frame}


\begin{frame}[plain, fragile]{Handling Time - The UTCDateTime Class}
    \begin{itemize}
        \item All absolute time values are consistently handled with this class.
        \item No ambiguities, e.g. timezones, leap seconds, \dots
        \item Based on a high precision POSIX timestamp
    \end{itemize}
\end{frame}


\begin{frame}[plain, fragile]{Features of UTCDateTime}
    \begin{itemize}
        \item Initialization
    \end{itemize}
\begin{myColorBox}{0.95}{}
\begin{python}
>>> from obspy.core import UTCDateTime
>>> UTCDateTime("2012-09-07T12:15:00")
UTCDateTime(2012, 9, 7, 12, 15)
>>> UTCDateTime(2012, 9, 7, 12, 15, 0)
UTCDateTime(2012, 9, 7, 12, 15)
>>> UTCDateTime(1347020100.0)
UTCDateTime(2012, 9, 7, 12, 15)
\end{python}
\end{myColorBox}


\begin{itemize}
    \item Time zone support
\end{itemize}

\begin{myColorBox}{0.95}{}
\begin{python}
>>> UTCDateTime("2012-09-07T12:15:00+02:00")
UTCDateTime(2012, 9, 7, 10, 15)
\end{python}
\end{myColorBox}


\end{frame}


\begin{frame}[plain, fragile]{Features of UTCDateTime}
    \begin{itemize}
        \item Attribute access
    \end{itemize}
\begin{myColorBox}{0.95}{}
\begin{python}
>>> time = UTCDateTime("2012-09-07T12:15:00")
>>> time.year
2012
>>> time.julday
251
>>> time.timestamp
1347020100.0
>>> time.weekday
4
\end{python}
\end{myColorBox}



\end{frame}



\begin{frame}[plain, fragile]{Features of UTCDateTime}
    \begin{itemize}
        \item Handling time differences
    \end{itemize}

\begin{myColorBox}{0.95}{}
\begin{python}
>>> time = UTCDateTime("2012-09-07T12:15:00")
>>> print time + 3600
2012-09-07T13:15:00.000000Z
>>> time2 = UTCDateTime(2012, 1, 1)
>>> print time - time2
21644100.0
\end{python}
\end{myColorBox}

\end{frame}


\begin{frame}[plain, fragile]{UTCDateTime - Exercises}
    \begin{enumerate}
        \item Calculate the number of hours passed since your birth. \\
            \begin{itemize}
                \item The current date and time can be obtained with \textbf{``UTCDateTime()''}
                \item Optional: Include the correct time zone
            \end{itemize}
        \item Get a list of 10 UTCDateTime objects, starting yesterday at 10:00 with a spacing of 90 minutes.
        \item The first session starts at 09:00 and lasts for 3 hours and 15
            minutes. Assuming we want to have the coffee break 1234 seconds and
            5 microseconds before it ends. At what time is the coffee break?
        \item Assume you had your last cup of coffee yesterday at breakfast.
            How many minutes do you have to survive with that cup of coffee?
    \end{enumerate}


\end{frame}





\begin{frame}[plain, fragile]{Handling Waveform Data}
\begin{myColorBox}{0.95}{}
\begin{python}
>>> from obspy.core import read
>>> st = read("waveform.mseed")
>>> print st
1 Trace(s) (*@in@*) Stream:
BW.FURT..EHZ | 2010-01-04... | 200.0 Hz, 7204234 samples
\end{python}
\end{myColorBox}
\begin{itemize}
    \item Automatic file format detection.
    \item Always results in a Stream object.
    \item Raw data available as a numpy.ndarray.
\end{itemize}
\begin{myColorBox}{0.95}{}
\begin{python}
>>> st[0].data
array([-426, -400, ... , -489, -339], dtype=int32)
\end{python}
\end{myColorBox}
\end{frame}

\begin{frame}[plain, fragile]{The Stream Object}
 \begin{itemize}
     \item A \textbf{Stream} object is a collection of \textbf{Trace} objects
 \end{itemize}

\begin{myColorBox}{0.95}{}
\begin{python}
>>> from obspy.core import read
>>> st = read()
>>> type(st)
obspy.core.stream.Stream
>>> print st
3 Trace(s) (*@in@*) Stream:
BW.RJOB..EHZ | 2009-08-24T00: ... | 100.0 Hz, 3000 samples
BW.RJOB..EHN | 2009-08-24T00: ... | 100.0 Hz, 3000 samples
BW.RJOB..EHE | 2009-08-24T00: ... | 100.0 Hz, 3000 samples
>>> st.traces
[<obspy.core.trace.Trace at 0x1017c8390>, ...]
>>> print st[0]
BW.RJOB..EHZ | 2009-08-24T00: ... | 100.0 Hz, 3000 samples
>>> type(st[0])
obspy.core.trace.Trace
\end{python}
\end{myColorBox}

\end{frame}

\begin{frame}[plain, fragile]{The Trace Object}

 \begin{itemize}
     \item A \textbf{Trace} object is a single, continuous waveform data block
     \item It furthermore contains a limited amount of metadata
 \end{itemize}


\begin{myColorBox}{0.95}{}
\begin{python}
>>> tr = st[0]
>>> print tr
BW.RJOB..EHZ | 2009-08-24T00: ... | 100.0 Hz, 3000 samples
>>> print tr.stats
         network: BW
         station: RJOB
        location:
         channel: EHZ
       starttime: 2009-08-24T00:20:03.000000Z
         endtime: 2009-08-24T00:20:32.990000Z
   sampling_rate: 100.0
           delta: 0.01
            npts: 3000
           calib: 1.0
\end{python}
\end{myColorBox}

\end{frame}


\begin{frame}[plain, fragile]{The Trace Object}
 \begin{itemize}
     \item For custom applications it is often necessary to directly manipulate
         the metadata of a Trace.
     \item The state of the Trace will stay consistent, as all values are
         derived from the starttime, the data and the sampling rate and are
         updated automatically.
 \end{itemize}

\begin{myColorBox}{0.95}{}
\begin{python}
>>> print tr.stats.delta, tr.stats.endtime
0.02 2009-08-24T00:20:27.980000Z
>>> tr.stats.sampling_rate = 5.0
>>> print tr.stats.delta, tr.stats.endtime
0.2 2009-08-24T00:23:27.800000Z
>>> print tr.stats.npts
3000
>>> tr.data = tr.data[:100]
>>> print tr.stats.npts, tr.stats.endtime
100 2009-08-24T00:20:27.800000Z

\end{python}
\end{myColorBox}

\end{frame}

\begin{frame}[plain, fragile]{The Trace Object}
 \begin{itemize}
     \item Working with them is easy, with a lot of attached methods.
 \end{itemize}

\begin{myColorBox}{0.95}{}
\begin{python}
>>> print tr
BW.RJOB..EHZ | 2009-08-24T00: ... | 100.0 Hz, 3000 samples
>>> tr.resample(sampling_rate=50.0)
>>> print tr
BW.RJOB..EHZ | 2009-08-24T00: ... | 50.0 Hz, 1500 samples
>>> tr.trim(tr.stats.starttime + 5, tr.stats.endtime - 5)
>>> print tr
BW.RJOB..EHZ | 2009-08-24T00: ... | 50.0 Hz, 500 samples
>>> tr.detrend("linear")
>>> tr.filter("highpass", freq=2.0)

\end{python}
\end{myColorBox}

\end{frame}

\begin{frame}[plain, fragile]{Stream Methods}

 \begin{itemize}
     \item Most methods that work on a \textbf{Trace} object also work on a \textbf{Stream} object. They are simply executed for every trace.
         \begin{itemize}
             \item \textbf{st.filter()} - Filter all attached traces.
             \item \textbf{st.trim()} - Cut all traces.
             \item \textbf{st.resample() / st.decimate()} - Change the sampling rate.
             \item \textbf{st.trigger()} - Run triggering algorithms.
             \item \textbf{st.plot() / st.spectrogram()} - Visualize the data.
             \item \textbf{st.simulate(), st.merge(), st.normalize(), st.detrend(), \dots}
         \end{itemize}
     \item A \textbf{Stream} object can also be exported to many formats making ObsPy a good tool for converting between different file formats.

\end{itemize}
\begin{myColorBox}{0.95}{}
\begin{python}
>>> st.write("output_file.sac", format="SAC")
\end{python}
\end{myColorBox}

\end{frame}

\begin{frame}[plain, fragile]{Waveform Data - Exercises}
    Later on a useful example application will be developed. For now the goal is to get to know the Stream and Trace classes.

    \vspace{2ex}

    Several possibilies to obtain a Stream object:
    \begin{itemize}
        \item The empty \textbf{read()} method will return some example data.
        \item Passing a filename to the \textbf{read()} method.
        \item Using one of the webservices. This will be dealt with in the next part.
        \item Passing a URL to \textbf{read()}. See e.g. \textit{examples.obspy.org/} for some files.
    \end{itemize}

    \vspace{2ex}

\end{frame}

\begin{frame}[plain, fragile]{Trace Exercise 1}
    \begin{itemize}
        \item Make a trace with all zeros (e.g. \textit{numpy.zeros(200)}) and an ideal pulse at the center
        \item Fill in some station information (\textit{network, station})
        \item Print trace summary and display the preview plot of the trace
        \item Change the sampling rate to 20Hz
        \item Change the \textit{starttime} to the start time of this sessions
        \item Print trace summary and display the preview plot of the trace again
    \end{itemize}
\end{frame}

\begin{frame}[plain, fragile]{Trace Exercise 2}
    \begin{itemize}
        \item Use \textit{tr.filter(...)} and apply a lowpass with 1s corner frequency
        \item Display the preview plot, there are a few seconds of zeros that we can cut off
        \item Use \textit{tr.trim(...)} to remove some of the zeros at start and end
    \end{itemize}
\end{frame}


\begin{frame}[plain, fragile]{Trace Exercise 3}
    \begin{itemize}
        \item Scale up the amplitudes of the trace by a factor of 500
        \item Make a copy of the original trace
        \item Add standard normal gaussian noise to the copied trace (use \textit{numpy.random.randn(..)})
        \item Change the station name of the copied trace
        \item Display the preview plot of the new trace
    \end{itemize}
\end{frame}


\begin{frame}[plain, fragile]{Stream Exercise 1}
    \begin{itemize}
        \item read the example earthquake data into a stream object (\textit{read()} without arguments)
        \item print the stream summary and display the preview plot
        \item assign the first trace to a new variable and then remove that trace from the original stream
        \item print the summary for the single trace and for the stream
    \end{itemize}
\end{frame}

\begin{frame}[plain, fragile]{Stream Exercise 2}
    \begin{itemize}
        \item Read the example earthquake data again
        \item Make a dictionary with paz information, assign poles at \textit{[-0.037+0.037j, -0.037-0.037j]}, zeros at \textit{[0j, 0j]}, the sensitivity of \textit{2.517e9} and unity gain
        \item Remove the instrument response using this paz dictionary
        \item Print the data maximum and minimum of the first trace (now in m/s)
        \item Save the data to a local file in MSEED format
    \end{itemize}
\end{frame}


\begin{frame}[plain, fragile]{Waveform Data - Exercises}

    Some further ideas what you can do now to get a better grasp of the objects:

    \begin{enumerate}
        \item Read some files from different sources and see what happens
        \item Have a look at the ObsPy Documentation on the homepage
        \item Use IPython's tab completion and help feature to explore objects
    \end{enumerate}


\end{frame}



\end{document}
